create PROCEDURE [dbo].[SSP_CheckCurrentStatusCodeForStartRun] --'<Json><ServicesAction>LoadReasonCodeList</ServicesAction><LookupCategory>ReasonCode</LookupCategory></Json>'(@xmlDoc XML)ASBEGINDeclare @sqlTotalCount nvarchar(4000)Declare @sql nvarchar(4000)Declare @OrderNumber nvarchar(max)Declare @LocationType BigintDeclare @AppCurrentStatusCode BigintDeclare @WorkFlowCode nvarchar(max)DECLARE @intPointer INT;EXEC sp_xml_preparedocument @intpointer OUTPUT,@xmlDocSELECT @OrderNumber =tmp.[OrderNumber],	   @LocationType=tmp.[LocationType],	   @WorkFlowCode=tmp.[WorkFlowCode],	   @AppCurrentStatusCode=tmp.[CurrentStatusCode]FROM OPENXML(@intpointer,'Json',2)			WITH			(			[OrderNumber] nvarchar(max),			[LocationType] Bigint,			[CurrentStatusCode] bigint,			[WorkFlowCode] nvarchar(max)			)tmp ;WITH XMLNAMESPACES('http://james.newtonking.com/projects/json' AS json) SELECT CAST((SELECT  'true' AS [@json:Array],o.CurrentState,isnull((Select top 1 ws.SequenceNo from WorkFlowStep ws where ws.WorkFlowCode=@WorkFlowCode and ws.StatusCode=o.CurrentState),0) as CurrentStateSequenceNo , @AppCurrentStatusCode as AppCurrentState,isnull((Select top 1 ws.SequenceNo from WorkFlowStep ws where ws.WorkFlowCode=@WorkFlowCode and ws.StatusCode=@AppCurrentStatusCode),0) as AppCurrentStatusSequenceNo From [Order] o where o.OrderNumber=@OrderNumberFOR XML path('OrderList'),ELEMENTS,ROOT('Order')) AS XML)				END