CREATE PROCEDURE [dbo].[SSP_CompanyDetailList_SelectByDropDown]-- '<Json><ServicesAction>LoadAllCompanyDetailListByDropDown</ServicesAction><CompanyType>28</CompanyType><CompanyId>1368</CompanyId></Json>'(@xmlDoc XML)ASBEGINDeclare @sqlTotalCount nvarchar(4000)Declare @sql nvarchar(4000)DECLARE @intPointer INT;DECLARE @whereClause NVARCHAR(max)Declare @PageSize INTDeclare @PageIndex INTDeclare @OrderBy NVARCHAR(20)Declare @CompanyType NVARCHAR(250)Declare @CompanyValue nvarchar(250)Declare @ParentCompany NVARCHAR(250)='0'declare @CompanyId  bigint EXEC sp_xml_preparedocument @intpointer OUTPUT,@xmlDocSELECT @CompanyType = tmp.[CompanyType],@ParentCompany=tmp.[ParentCompany],@CompanyId =tmp.[CompanyId],@CompanyValue = tmp.[CompanyValue]   FROM OPENXML(@intpointer,'Json',2)   WITH   (     [CompanyType] nvarchar(250),   [ParentCompany] nvarchar(250),   CompanyId bigint ,   [CompanyValue] nvarchar(250)     )tmpset  @orderBy =''set  @whereClause =''IF(RTRIM(@orderBy) = '') BEGIN SET @orderBy = 'tmp.[CompanyName]' ENDIF(RTRIM(@whereClause) = '') BEGIN SET @whereClause = '1=1' ENDIF @CompanyType !=''  and  @CompanyType  is not nullBEGIN SET @whereClause = @whereClause + ' and tmp.CompanyType =  ''' +@CompanyType+ ''''ENDIF @ParentCompany !='0'BEGIN SET @whereClause = @whereClause + ' and tmp.ParentCompany =  ''' +@ParentCompany+ ''''ENDIF @CompanyId !='0'  and   @CompanyId is not nullBEGIN SET @whereClause = @whereClause + ' and tmp.CompanyId =  ''' +Convert(nvarchar(250),@CompanyId)   + ''''ENDIF @CompanyValue is  nullBEGIN SET @CompanyValue = '';END SET @sql = 'WITH XMLNAMESPACES(''http://james.newtonking.com/projects/json'' AS json)  select cast ((  select ''true'' AS [@json:Array]  , * from ( SELECT     COUNT(CompanyId) OVER () as TotalCount, [CompanyId] ,[CompanyId] as  [Id]      ,[CompanyName]      ,[CompanyMnemonic]	  ,[CompanyName]+'' (''+ISNULL([CompanyMnemonic],''-'')+'')'' as CompanyNameAndMnemonic	  ,[CompanyName]+'' (''+ISNULL([CompanyMnemonic],''-'')+'')'' as Name	  ,[CompanyType]      	FROM [dbo].Company   where IsActive=1 and (CompanyName like ''%' + @CompanyValue +'%'' or CompanyMnemonic like ''%' + @CompanyValue +'%'')) tmp   WHERE ' + @whereClause + ' ORDER BY '+@orderBy+'   FOR XML path(''CompanyList''),ELEMENTS,ROOT(''Json'')) AS XML)'    PRINT @sql --SELECT @ProcessConfiguration as ProcessConfigurationId FOR XML RAW('Json'),ELEMENTS EXEC sp_executesql @sqlEND