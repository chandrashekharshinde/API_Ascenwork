CREATE PROCEDURE [dbo].[SSP_GetCompanyDetailsByCompanyId]
(
@xmlDoc XML
)
AS

BEGINDECLARE @intPointer INT;declare @CompanyId bigint = 0EXEC sp_xml_preparedocument @intpointer OUTPUT,@xmlDocSELECT @CompanyId=tmp.[CompanyId]		  FROM OPENXML(@intpointer,'Json',2)			WITH			(				[CompanyId] bigint			)tmp;			WITH XMLNAMESPACES('http://james.newtonking.com/projects/json' AS json)  SELECT CAST((SELECT  'true' AS [@json:Array],                c.CompanyId,                c.CompanyName,				c.CompanyMnemonic,				c.CompanyType,				c.ParentCompany,				c.AddressLine1,				c.AddressLine2,				c.AddressLine3,				c.City,				c.State,					c.CountryId,				c.Country,				c.Postcode,				c.Region,				c.RouteCode,				c.CategoryCode,				c.BranchPlant,				c.Email,				c.TaxId,					c.SoldTo,					c.ShipTo,				c.BillTo,				c.SiteURL,				c.Logo,				c.header,				c.footer,				c.CreatedBy,				c.CreatedDate,				c.ModifiedBy,				c.ModifiedDate,				c.IsActive,				c.SequenceNo,				c.SubChannel,				c.Field1,				c.Field2,				c.Field3,				c.Field4,				c.Field5,				c.Field6,				c.Field7,				c.Field8,				c.Field9,				c.Field10,					c.CreditLimit,				c.AvailableCreditLimit,				c.EmptiesLimit,				c.ActualEmpties,CategoryType,				c.PaymentTermCode,				(select cast ((SELECT  'true' AS [@json:Array] ,				ZoneCodeId,				ZoneCodeId				CompanyId,					ZoneCode  as Id,				ZoneName,					IsActive,				CreatedBy,				CreatedDate,				UpdatedBy,				UpdatedDate				from ZoneCode zc  where zc.CompanyId = c.CompanyId and zc.isactive=1				FOR XML path('ZoneCodeList'),ELEMENTS) AS xml)),				(select cast ((SELECT  'true' AS [@json:Array] ,				CompanyBranchPlantId,					CompanyId,				BranchPlantId as Id,					LocationName,					IsActive,				CreatedBy,				CreatedDate,				UpdatedBy,				UpdatedDate				from CompanyBranchPlant cbp  where cbp.CompanyId = c.CompanyId and cbp.isactive=1				FOR XML path('CompanyBranchPlantList'),ELEMENTS) AS xml)),				(select cast ((SELECT  'true' AS [@json:Array],				CompanyProductTypeId,					CompanyId,				ProductTypeCode as Id,				ProductTypeName as [Name],					IsActive,				CreatedBy,				CreatedDate,				UpdatedBy,				UpdatedDate				UpdatedDate				from CompanyProductType cbt  where cbt.CompanyId = c.CompanyId and cbt.isactive=1				FOR XML path('CompanyProductTypeList'),ELEMENTS) AS xml)),				(select cast ((SELECT  'true' AS [@json:Array],				AccountName  as AccountName,				BankName  as BankName,					AccountNumber as AccountNumber,				AccountTypeId as AccountTypeId,				AccountType as AccountType,				IsActive as IsActive,				CreatedBy as CreatedBy				from TransporterAccountDetail Account where Account.ObjectId=c.CompanyId and Account.ObjectType='Company'				FOR XML path('TransporterAccountDetailsList'),ELEMENTS) AS xml)),				(select cast ((SELECT  'true' AS [@json:Array] ,				ObjectId as ContactTypeId,				ObjectType as ObjectType,				ContactType as ContactType,					ContactPerson as ContactPersonName,				Contacts as  ContactPersonNumber,					IsActive as IsActive,				CreatedBy as CreatedBy				from ContactInformation contact where contact.ObjectId=c.CompanyId and ObjectType='Company'				FOR XML path('ContactInformationList'),ELEMENTS) AS xml)),				(select cast ((SELECT  'true' AS [@json:Array] ,				 fc.[FinanceTransporterMappingId]
				,fc.[TransporterId]
				,(Select  ct.CompanyName from Company ct where ct.CompanyId=fc.TransporterId) as Transporter
				,fc.[FinancePartnerId]
				,fc.[Amount]
				,convert(date,fc.[FromDate],103) as [FromDate]
				,convert(date,fc.[ToDate],103) as [ToDate]				,fc.IsActive				,fc.CreatedBy				from FinanceTransporterMapping fc where fc.FinancePartnerId=c.CompanyId 				FOR XML path('FinanceTransporterMappingList'),ELEMENTS) AS xml)),				(select cast ((SELECT  'true' AS [@json:Array] ,				Procat.LocationAndProductCategoryMappingId, 				Procat.ObjectId ,				Procat.ObjectType,				Procat.ProductCategoryId as Id,				Procat.CreatedBy,				Procat.CreatedDate,				Procat.ModifiedBy,				Procat.ModifiedDate,				Procat.IsActive				from LocationAndProductCategoryMapping Procat where Procat.ObjectId=c.CompanyId and Procat.ObjectType='Company'				FOR XML path('ProductCategoryList'),ELEMENTS) AS xml)),				(select cast ((SELECT  'true' AS [@json:Array]  ,DocumentsId  , DocumentExtension  ,DocumentName,   DocumentBase64  , 
				ObjectId  ,ObjectType   ,IsActive,DocumentTypeId  , (select  Name  from  LookUp  where LookUpId=DocumentTypeId)  as 'DocumentType' , 
				NEWID() as 'DocumentinfoGUID'   from Documents  where ObjectId=c.CompanyId   and ObjectType ='Company'
				FOR XML path('DocumentInformationList'),ELEMENTS) AS xml))FROM Company c	 where c.IsActive = 1 and c.CompanyId=@CompanyIdFOR XML path('CompanyList'),ELEMENTS,ROOT('Json')) AS XML)END