Create procedure [dbo].[USP_Lookup] --'<Json><ServicesAction>SaveLookup</ServicesAction><LookupCategoryList><LookupId>9</LookupId><Name>Bottl</Name><Code>Bottles</Code><LookupCategory>6</LookupCategory><IsActive>true</IsActive><ResourceKey></ResourceKey><Criteria></Criteria><Createdby>1</Createdby></LookupCategoryList></Json>'(	@xmlDoc xml)ASBEGIN SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED	SET ARITHABORT ON 	DECLARE @TranName NVARCHAR(255)	DECLARE @ErrMsg NVARCHAR(2048)	DECLARE @ErrSeverity INT;	DECLARE @intPointer INT;	SET @ErrSeverity = 15; 	BEGIN TRY		EXEC sp_xml_preparedocument @intpointer OUTPUT,@xmlDoc					DECLARE @LookupCategory bigint; 		DECLARE @LookupId bigint;		DECLARE @Name nvarchar(100); 		DECLARE @count BIGINT		SELECT			@LookupId=tmp.[LookupId],			@LookupCategory = tmp.[LookupCategory],			@Name=tmp.[Name]		FROM OPENXML(@intpointer,'Json/LookupCategoryList',2)		WITH		(			[LookupId] [bigint],			[LookupCategory] [bigint],			[Name]	[nvarchar](100)		)tmp		SET @count=(					SELECT COUNT(LookupId) 					FROM dbo.[Lookup] 					WHERE LookupCategory=@LookupCategory					And Name=@Name					And LookupId<>@LookupId					And IsActive=1					)		IF(@count>0)		BEGIN			SET @LookupId= 0		END		ELSE		BEGIN			--select * from lookup			UPDATE dbo.Lookup 			SET				--	[LookupType]=tmp.[LookupTypeId]				[Name]=tmp.[Name]				,[Code]=tmp.[Code]				,[Description]=tmp.[Description]				,[IsActive]=tmp.[IsActive]								,ModifiedBy =tmp.[CreatedBy]				,ModifiedDate=GETDATE()			FROM OPENXML(@intpointer,'Json/LookupCategoryList',2)			WITH			(				--[LookupTypeId] [bigint],				[LookupId] [bigint],				[Name]	[nvarchar](100),				[Code]	[nvarchar](100),				[Description] [nvarchar](100),				[IsActive] [bit],								[CreatedBy] [bigint]			)tmp WHERE Lookup.LookupId=tmp.[LookupId]		End            		SELECT  @LookupId as LookupId FOR XML RAW('Json'),ELEMENTS        exec sp_xml_removedocument @intPointer			END TRY	BEGIN CATCH		SELECT @ErrMsg = ERROR_MESSAGE();		RAISERROR(@ErrMsg, @ErrSeverity, 1);		RETURN; 	END CATCHEND